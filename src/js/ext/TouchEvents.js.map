{"version":3,"sources":["../../es6/ext/TouchEvents.js"],"names":[],"mappings":"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","file":"TouchEvents.js","sourcesContent":["/** @flow\n * StratoDem Analytics : TouchEvents\n * Principal Author(s) : Michael Clawar\n * Secondary Author(s) :\n * Description :\n *\n *  (c) 2016- StratoDem Analytics, LLC\n *  All Rights Reserved\n */\n\nimport L from 'leaflet';\n\ntype T_EVENT = {\n  pointerType: string,\n  touches?: Array<{pageX: number, pageY: number}>,\n  pageX: number,\n  pageY: number,\n  timeStamp: number,\n  originalEvent: {timeStamp: number},\n  target: {_simulatedClick: Object},\n};\n\nL.Map.mergeOptions({touchExtend: true});\n\n\nclass TouchExtend extends L.Handler {\n  _map: L.Map;\n\n  initialize(map: L.Map): void {\n    this._map = map;\n    this._container = map._container;\n    this._pane = map._panes.overlayPane;\n  }\n\n  /** Adds dom listener events to the map container **/\n  addHooks(): void {\n    L.DomEvent.on(this._container, 'touchstart', this._onTouchStart, this);\n    L.DomEvent.on(this._container, 'touchend', this._onTouchEnd, this);\n    L.DomEvent.on(this._container, 'touchmove', this._onTouchMove, this);\n\n    if (TouchExtend._detectIE()) {\n      L.DomEvent.on(this._container, 'MSPointerDown', this._onTouchStart, this);\n      L.DomEvent.on(this._container, 'MSPointerUp', this._onTouchEnd, this);\n      L.DomEvent.on(this._container, 'MSPointerMove', this._onTouchMove, this);\n      L.DomEvent.on(this._container, 'MSPointerCancel', this._onTouchCancel, this);\n    } else {\n      L.DomEvent.on(this._container, 'touchcancel', this._onTouchCancel, this);\n      L.DomEvent.on(this._container, 'touchleave', this._onTouchLeave, this);\n    }\n  }\n\n  /** Removes dom listener events from the map container **/\n  removeHooks(): void {\n    L.DomEvent.off(this._container, 'touchstart', this._onTouchStart);\n    L.DomEvent.off(this._container, 'touchend', this._onTouchEnd);\n    L.DomEvent.off(this._container, 'touchmove', this._onTouchMove);\n    if (TouchExtend._detectIE()) {\n      L.DomEvent.off(this._container, 'MSPointerDowm', this._onTouchStart);\n      L.DomEvent.off(this._container, 'MSPointerUp', this._onTouchEnd);\n      L.DomEvent.off(this._container, 'MSPointerMove', this._onTouchMove);\n      L.DomEvent.off(this._container, 'MSPointerCancel', this._onTouchCancel);\n    } else {\n      L.DomEvent.off(this._container, 'touchcancel', this._onTouchCancel);\n      L.DomEvent.off(this._container, 'touchleave', this._onTouchLeave);\n    }\n  }\n\n  _touchEvent(event: T_EVENT, type): void {\n    // TODO: fix the pageX error that is do a bug in Android\n    // where a single touch triggers two click events\n    // _filterClick is what leaflet uses as a workaround.\n    // This is a problem with more things than just android.\n    // Another problem is touchEnd has no touches in its touch list.\n    let touchEvent = {};\n    if (typeof event.touches !== 'undefined') {\n      if (!event.touches.length)\n        return;\n      touchEvent = event.touches[0];\n    } else if (event.pointerType === 'touch') {\n      touchEvent = event;\n      if (!TouchExtend._filterClick(event))\n        return;\n    } else\n      return;\n\n    const containerPoint = this._map.mouseEventToContainerPoint(touchEvent);\n    const layerPoint = this._map.mouseEventToLayerPoint(touchEvent);\n    const latlng = this._map.layerPointToLatLng(layerPoint);\n\n    this._map.fire(type, {\n      latlng,\n      layerPoint,\n      containerPoint,\n      pageX: touchEvent.pageX,\n      pageY: touchEvent.pageY,\n      originalEvent: event,\n    });\n  }\n\n  /** Borrowed from Leaflet and modified for bool ops **/\n  static _filterClick(event: T_EVENT): boolean {\n    const timeStamp = (event.timeStamp || event.originalEvent.timeStamp);\n    const elapsed = L.DomEvent._lastClick && (timeStamp - L.DomEvent._lastClick);\n\n    // are they closer together than 500ms yet more than 100ms?\n    // Android typically triggers them ~300ms apart while multiple listeners\n    // on the same event should be triggered far faster;\n    // or check if click is simulated on the element, and if it is, reject any non-simulated events\n    if ((elapsed && elapsed > 100 && elapsed < 500)\n      || (event.target._simulatedClick && !event._simulated)) {\n      L.DomEvent.stop(event);\n      return false;\n    }\n\n    L.DomEvent._lastClick = timeStamp;\n    return true;\n  }\n\n  _onTouchStart(event: T_EVENT): void {\n    if (!this._map._loaded)\n      return;\n\n    const type = 'touchstart';\n    this._touchEvent(event, type);\n  }\n\n  _onTouchEnd(event: T_EVENT): void {\n    if (!this._map._loaded)\n      return;\n\n    const type = 'touchend';\n    this._touchEvent(event, type);\n  }\n\n  _onTouchCancel(event: T_EVENT): void {\n    if (!this._map._loaded)\n      return;\n\n    const type = TouchExtend._detectIE() ? 'pointercancel' : 'touchcancel';\n    this._touchEvent(event, type);\n  }\n\n  _onTouchLeave(event: T_EVENT): void {\n    if (!this._map._loaded)\n      return;\n\n    const type = 'touchleave';\n    this._touchEvent(event, type);\n  }\n\n  _onTouchMove(event: T_EVENT): void {\n    if (!this._map._loaded)\n      return;\n\n    const type = 'touchmove';\n    this._touchEvent(event, type);\n  }\n\n  static _detectIE(): number | false {\n    const ua = window.navigator.userAgent;\n\n    const msie = ua.indexOf('MSIE ');\n    if (msie > 0) {\n      // IE 10 or older => return version number\n      return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n    }\n\n    const trident = ua.indexOf('Trident/');\n    if (trident > 0) {\n      // IE 11 => return version number\n      const rv = ua.indexOf('rv:');\n      return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n    }\n\n    const edge = ua.indexOf('Edge/');\n    if (edge > 0) {\n      // IE 12 => return version number\n      return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n    }\n\n    // other browser\n    return false;\n  }\n}\n\nL.Map.addInitHook('addHandler', 'touchExtend', TouchExtend);\n\n\n/**\n * This isn't full Touch support.\n * This is just to get markers to also support dom touch events after creation\n * #TODO: find a better way of getting markers to support touch.\n */\nexport class TouchMarker extends L.Marker {\n  _initInteraction(): Object {\n    if (!this.addInteractiveTarget) // 0.7.x support $FlowFixMe\n      return this._initInteractionLegacy();\n\n    // TODO this may need be updated to re-add touch events for 1.0+\n    return super._initInteraction();\n  }\n\n  /** This is an exact copy of https://github.com/Leaflet/Leaflet/blob/v0.7/src/layer/marker/Marker.js\n   * with the addition of the touch events\n   **/\n  _initInteractionLegacy(): void {\n    if (!this.options.clickable)\n      return;\n\n    // TODO refactor into something shared with Map/Path/etc. to DRY it up\n    const icon = this._icon;\n    const events = [\n      'dblclick',\n      'mousedown',\n      'mouseover',\n      'mouseout',\n      'contextmenu',\n      'touchstart',\n      'touchend',\n      'touchmove',\n    ];\n    if (TouchMarker._detectIE)\n      events.concat(['MSPointerDown', 'MSPointerUp', 'MSPointerMove', 'MSPointerCancel']);\n    else\n      events.concat(['touchcancel']);\n\n    L.DomUtil.addClass(icon, 'leaflet-clickable');\n    L.DomEvent.on(icon, 'click', this._onMouseClick, this);\n    L.DomEvent.on(icon, 'keypress', this._onKeyPress, this);\n\n    events.forEach(event => L.DomEvent.on(icon, event, this._fireMouseEvent, this));\n\n    if (L.Handler.MarkerDrag) {\n      this.dragging = new L.Handler.MarkerDrag(this);\n\n      if (this.options.draggable)\n        this.dragging.enable();\n    }\n  }\n\n  static _detectIE(): number | false {\n    const ua = window.navigator.userAgent;\n\n    const msie = ua.indexOf('MSIE ');\n    if (msie > 0) {\n      // IE 10 or older => return version number\n      return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n    }\n\n    const trident = ua.indexOf('Trident/');\n    if (trident > 0) {\n      // IE 11 => return version number\n      const rv = ua.indexOf('rv:');\n      return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n    }\n\n    const edge = ua.indexOf('Edge/');\n    if (edge > 0) {\n      // IE 12 => return version number\n      return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n    }\n\n    // other browser\n    return false;\n  }\n}\n"]}