{"version":3,"sources":["../../../es6/edit/handler/Rectangle.js"],"names":[],"mappings":"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","file":"Rectangle.js","sourcesContent":["/** @flow\n * StratoDem Analytics : Rectangle\n * Principal Author(s) : Michael Clawar\n * Secondary Author(s) :\n * Description :\n *\n *  (c) 2016- StratoDem Analytics, LLC\n *  All Rights Reserved\n */\n\nimport L from 'leaflet';\n\nimport Event from '../../Event';\nimport SimpleShape from './SimpleShape';\n\n\nexport default class Rectangle extends SimpleShape {\n  _createMoveMarker(): void {\n    const bounds = this._shape.getBounds();\n    const center = bounds.getCenter();\n\n    this._moveMarker = this._createMarker(center, this.options.moveIcon);\n  }\n\n  _createResizeMarker(): void {\n    const corners = this._getCorners();\n\n    this._resizeMarkers = corners.map((corner, idx) => {\n      const marker = this._createMarker(corner, this.options.resizeIcon);\n      marker._cornerIndex = idx;\n      return marker;\n    });\n  }\n\n  _onMarkerDragStart(event: {target: L.Marker}): void {\n    SimpleShape.prototype._onMarkerDragStart.call(this, event);\n\n    // Save a reference to the opposite point\n    const corners = this._getCorners();\n    const marker = event.target;\n    const currentCornerIndex = marker._cornerIndex;\n\n    this._oppositeCorner = corners[(currentCornerIndex + 2) % 4];\n\n    this._toggleCornerMarkers(0);\n  }\n\n  _onMarkerDragEnd(event: {target: L.Marker}): void {\n    const marker = event.target;\n\n    // Reset move marker position to the center\n    if (marker === this._moveMarker) {\n      const bounds = this._shape.getBounds();\n      const center = bounds.getCenter();\n\n      marker.setLatLng(center);\n    }\n\n    this._toggleCornerMarkers(1);\n\n    this._repositionCornerMarkers();\n\n    SimpleShape.prototype._onMarkerDragEnd.call(this, event);\n  }\n\n  _move(newCenter: L.LatLng): void {\n    const latlngs = this._shape._defaultShape\n      ? this._shape._defaultShape()\n      : this._shape.getLatLngs();\n    const bounds = this._shape.getBounds();\n    const center = bounds.getCenter();\n\n    // Offset the latlngs to the new center\n    const newLatLngs = latlngs.map(ll =>\n      ([\n        newCenter.lat + (ll.lat - center.lat),\n        newCenter.lng + (ll.lng - center.lng)]));\n\n    this._shape.setLatLngs(newLatLngs);\n\n    // Reposition the resize markers\n    this._repositionCornerMarkers();\n\n    this._map.fire(Event.EDITMOVE, { layer: this._shape });\n  }\n\n  _resize(latlng: L.LatLng): void {\n    // Update the shape based on the current position of this corner and the opposite point\n    this._shape.setBounds(L.latLngBounds(latlng, this._oppositeCorner));\n\n    // Reposition the move marker\n    const bounds = this._shape.getBounds();\n    this._moveMarker.setLatLng(bounds.getCenter());\n\n    this._map.fire(Event.EDITRESIZE, { layer: this._shape });\n  }\n\n  _getCorners(): Array<L.LatLng> {\n    const bounds = this._shape.getBounds();\n\n    return [\n      bounds.getNorthWest(),\n      bounds.getNorthEast(),\n      bounds.getSouthEast(),\n      bounds.getSouthWest(),\n    ];\n  }\n\n  _toggleCornerMarkers(opacity: number): void {\n    this._resizeMarkers.forEach(m => m.setOpacity(opacity));\n  }\n\n  _repositionCornerMarkers(): void {\n    const corners = this._getCorners();\n\n    this._resizeMarkers.forEach((m, idx) => { m.setLatLng(corners[idx]); });\n  }\n}\n\n\nL.Rectangle.addInitHook(function addHook() {\n  if (Rectangle) {\n    this.editing = new Rectangle(this);\n\n    if (this.options.editable) {\n      this.editing.enable();\n    }\n  }\n});\n"]}