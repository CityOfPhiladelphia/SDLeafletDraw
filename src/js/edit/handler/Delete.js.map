{"version":3,"sources":["../../../es6/edit/handler/Delete.js"],"names":[],"mappings":"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","file":"Delete.js","sourcesContent":["/** @flow\n * StratoDem Analytics : Delete\n * Principal Author(s) : Michael Clawar\n * Secondary Author(s) :\n * Description :\n *\n *  (c) 2016- StratoDem Analytics, LLC\n *  All Rights Reserved\n */\n\nimport L from 'leaflet';\n\nimport drawLocal from '../../draw';\nimport Event from '../../Event';\nimport Tooltip from '../../Tooltip';\nimport { TYPE_REMOVE } from './constants';\n\n\nclass BaseDelete extends L.Handler {\n  _deleteableLayers: L.FeatureGroup;\n  _map: L.Map;\n\n  static TYPE = TYPE_REMOVE;\n\n  initialize(map: L.Map, options: Object) {\n    L.Handler.prototype.initialize.call(this, map);\n\n    L.Util.setOptions(this, options);\n\n    // Store the selectable layer group for ease of access\n    this._deletableLayers = this.options.featureGroup;\n\n    if (!(this._deletableLayers instanceof L.FeatureGroup)) {\n      throw new Error('options.featureGroup must be a L.FeatureGroup');\n    }\n\n    // Save the type so super can fire, need to do this as cannot do this.TYPE :(\n    this.type = BaseDelete.TYPE;\n  }\n\n  /** Enable the delete toolbar **/\n  enable(): void {\n    if (this._enabled || !this._hasAvailableLayers()) {\n      return;\n    }\n    this.fire('enabled', { handler: this.type });\n\n    this._map.fire(Event.DELETESTART, { handler: this.type });\n\n    L.Handler.prototype.enable.call(this);\n\n    this._deletableLayers\n      .on('layeradd', this._enableLayerDelete, this)\n      .on('layerremove', this._disableLayerDelete, this);\n  }\n\n  /** Disable the delete toolbar **/\n  disable(): void {\n    if (!this._enabled)\n      return;\n\n    this._deletableLayers\n      .off('layeradd', this._enableLayerDelete, this)\n      .off('layerremove', this._disableLayerDelete, this);\n\n    L.Handler.prototype.disable.call(this);\n\n    this._map.fire(Event.DELETESTOP, { handler: this.type });\n\n    this.fire('disabled', { handler: this.type });\n  }\n\n  /** Add listener hooks to this handler **/\n  addHooks(): void {\n    if (this._map) {\n      this._map.getContainer().focus();\n\n      this._deletableLayers.eachLayer(this._enableLayerDelete, this);\n      this._deletedLayers = new L.LayerGroup();\n\n      // TODO replace this\n      this._tooltip = new Tooltip(this._map);\n      this._tooltip.updateContent({ text: drawLocal.edit.handlers.remove.tooltip.text });\n\n      this._map.on('mousemove', this._onMouseMove, this);\n    }\n  }\n\n  /** Remove listener hooks from this handler **/\n  removeHooks(): void {\n    if (this._map) {\n      this._deletableLayers.eachLayer(this._disableLayerDelete, this);\n      this._deletedLayers = null;\n\n      this._tooltip.dispose();\n      this._tooltip = null;\n\n      this._map.off('mousemove', this._onMouseMove, this);\n    }\n  }\n\n  /** Rever the deleted layers back to their prior state **/\n  revertLayers(): void {\n    // Iterate of the deleted layers and add them back into the featureGroup\n    this._deletedLayers.eachLayer(function revertLayer(layer) {\n      this._deletableLayers.addLayer(layer);\n      layer.fire('revert-deleted', {layer});\n    }, this);\n  }\n\n  /** Save deleted layers **/\n  save(): void {\n    this._map.fire(Event.DELETED, { layers: this._deletedLayers });\n  }\n\n  /** Remove all layers that can be deleted **/\n  removeAllLayers(): void {\n    // Iterate over layers and remove them\n    this._deletableLayers.eachLayer(function removeLayer(layer) {\n      this._removeLayer({layer});\n    }, this);\n    this.save();\n  }\n\n  _enableLayerDelete(event: {layer?: L.Layer, target?: L.Layer} | L.Layer): void {\n    const layer = event.layer || event.target || event;\n\n    // $FlowFixMe\n    layer.on('click', this._removeLayer, this);\n  }\n\n  _disableLayerDelete(event: {layer?: L.Layer, target?: L.Layer} | L.Layer): void {\n    const layer = event.layer || event.target || event;\n\n    // $FlowFixMe\n    layer.off('click', this._removeLayer, this);\n\n    // Remove from the deleted layers so we can't accidentally revert if the user presses cancel\n    this._deletedLayers.removeLayer(layer);\n  }\n\n  _removeLayer(event: {layer?: L.Layer, target?: L.Layer} | L.Layer): void {\n    const layer = event.layer || event.target || event;\n\n    this._deletableLayers.removeLayer(layer);\n\n    this._deletedLayers.addLayer(layer);\n\n    // $FlowFixMe\n    layer.fire('deleted');\n  }\n\n  _onMouseMove(event: {latlng: L.LatLng}): void {\n    this._tooltip.updatePosition(event.latlng);\n  }\n\n  _hasAvailableLayers(): boolean {\n    return this._deletableLayers.getLayers().length !== 0;\n  }\n}\n\nconst Delete = BaseDelete.extend({includes: L.Evented.prototype});\nexport default Delete;\n"]}