{"version":3,"sources":["../es6/Toolbar.js"],"names":[],"mappings":"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","file":"Toolbar.js","sourcesContent":["/** @flow\n * StratoDem Analytics : Toolbar\n * Principal Author(s) : Michael Clawar\n * Secondary Author(s) :\n * Description :\n *\n *  (c) 2016- StratoDem Analytics, LLC\n *  All Rights Reserved\n */\n\nimport L from 'leaflet';\n\n\nclass BaseToolbar extends L.Class {\n  _actionButtons: Array<Object>;\n  _activeMode: Object | null;\n  _modes: Object;\n\n  initialize(options: Object): void {\n    L.setOptions(this, options);\n\n    this._modes = {};\n    this._actionButtons = [];\n    this._activeMode = null;\n  }\n\n  enabled(): boolean {\n    return this._activeMode !== null;\n  }\n\n  /** Disables the toolbar **/\n  disable(): void {\n    if (!this.enabled())\n      return;\n\n    if (this._activeMode === null) return;\n    this._activeMode.handler.disable();\n  }\n\n  /** Adds the toolbar to the map and returns the DOM element **/\n  addToolbar(map: L.Map): L.DomUtil | null {\n    const container = L.DomUtil.create('div', 'leaflet-draw-section');\n    let buttonIndex = 0;\n    const buttonClassPrefix = this._toolbarClass || '';\n\n    this._toolbarContainer = L.DomUtil.create('div', 'leaflet-draw-toolbar leaflet-bar');\n    this._map = map;\n\n    this.getModeHandlers(map).forEach((mh) => {\n      if (mh.enabled)\n        this._initModeHandler(\n          mh.handler,\n          this._toolbarContainer,\n          buttonIndex += 1,\n          buttonClassPrefix,\n          mh.title);\n    });\n\n    // if no buttons were added, do not add the toolbar\n    if (buttonIndex === 0)\n      return null;\n\n    // Save button index of the last button, -1 as we would have ++ after the last button\n    this._lastButtonIndex = buttonIndex - 1;\n\n    // Create empty actions part of the toolbar\n    this._actionsContainer = L.DomUtil.create('ul', 'leaflet-draw-actions');\n\n    // Add draw and cancel containers to the control container\n    container.appendChild(this._toolbarContainer);\n    container.appendChild(this._actionsContainer);\n\n    return container;\n  }\n\n  /** Removes the toolbar and drops the handler event listeners **/\n  removeToolbar(): void {\n    // Dispose each handler\n    Object.keys(this._modes).forEach((k: string) => {\n      const mode = this._modes[k];\n      BaseToolbar._disposeButton(mode.button, mode.handler.enable);\n\n      // Make sure this is disabled\n      mode.handler.disable();\n      // Unbind handler\n      mode.handler\n        .off('enabled', this._handlerActivated, this)\n        .off('disabled', this._handlerDeactivated, this);\n    });\n    this._modes = {};\n\n    // Dispose the actions toolbar\n    this._actionButtons\n      .forEach(button => BaseToolbar._disposeButton(button.button, button.callback));\n    this._actionButtons = [];\n    this._actionsContainer = null;\n  }\n\n  _initModeHandler(handler: Object, container: L.DomUtil,\n                   buttonIndex: number, classNamePrefix: string, buttonTitle: string): void {\n    const type = handler.type;\n\n    const modeHandler = {\n      handler,\n      button: BaseToolbar._createButton({\n        type,\n        title: buttonTitle,\n        className: `${classNamePrefix}-${type}`,\n        container,\n        callback: handler.enable,\n        context: handler,\n      }),\n      buttonIndex,\n    };\n    modeHandler.handler\n      .on('enabled', this._handlerActivated, this)\n      .on('disabled', this._handlerDeactivated, this);\n\n    this._modes[type] = modeHandler;\n  }\n\n  static _createButton(options: Object): L.DomUtil {\n    const link = L.DomUtil.create('a', options.className || '', options.container);\n    // Screen reader tag\n    const sr = L.DomUtil.create('span', 'sr-only', options.container);\n\n    link.href = '#';\n    link.appendChild(sr);\n\n    if (options.title) {\n      link.title = options.title;\n      sr.innerHTML = options.title;\n    }\n\n    if (options.text) {\n      link.innerHTML = options.text;\n      sr.innerHTML = options.text;\n    }\n\n    L.DomEvent\n      .on(link, 'click', L.DomEvent.stopPropagation)\n      .on(link, 'mousedown', L.DomEvent.stopPropagation)\n      .on(link, 'dblclick', L.DomEvent.stopPropagation)\n      .on(link, 'touchstart', L.DomEvent.stopPropagation)\n      .on(link, 'click', L.DomEvent.preventDefault)\n      .on(link, 'click', options.callback, options.context);\n\n    return link;\n  }\n\n  static _disposeButton(button: L.DomUtil, callback: (any) => void) {\n    L.DomEvent.off(button, 'click', L.DomEvent.stopPropagation);\n    L.DomEvent.off(button, 'mousedown', L.DomEvent.stopPropagation);\n    L.DomEvent.off(button, 'dblclick', L.DomEvent.stopPropagation);\n    L.DomEvent.off(button, 'touchstart', L.DomEvent.stopPropagation);\n    L.DomEvent.off(button, 'click', L.DomEvent.preventDefault);\n    L.DomEvent.off(button, 'click', callback);\n  }\n\n  _handlerActivated(event: {handler: Object}): void {\n    // Disable active mode (if present)\n    this.disable();\n\n    // Cache new active feature\n    this._activeMode = this._modes[event.handler];\n\n    L.DomUtil.addClass(this._activeMode.button, 'leaflet-draw-toolbar-button-enabled');\n\n    this._showActionsToolbar();\n\n    this.fire('enable');\n  }\n\n  _handlerDeactivated(): void {\n    this._hideActionsToolbar();\n\n    // $FlowFixMe\n    L.DomUtil.removeClass(this._activeMode.button, 'leaflet-draw-toolbar-button-enabled');\n\n    this._activeMode = null;\n\n    this.fire('disable');\n  }\n\n  _createActions(handler: Object): void {\n    const container = this._actionsContainer;\n    const buttons = this.getActions(handler);\n\n    // Dispose the actions toolbar (todo: dispose only not used buttons)\n    this._actionButtons\n      .forEach(button => BaseToolbar._disposeButton(button.button, button.callback));\n    this._actionButtons = [];\n\n    // Remove all old buttons\n    while (container.firstChild)\n      container.removeChild(container.firstChild);\n\n    this._actionButtons = buttons\n      .filter(button => !('enabled' in button && !button.enabled))\n      .map(button => ({\n        button: BaseToolbar._createButton({\n          title: button.title,\n          text: button.text,\n          container: L.DomUtil.create('li', '', container),\n          callback: button.callback,\n          context: button.context,\n        }),\n        callback: button.callback,\n      }));\n  }\n\n  _showActionsToolbar(): void {\n    if (this._activeMode === null) return;\n    const buttonIndex = this._activeMode.buttonIndex;\n    const lastButtonIndex = this._lastButtonIndex;\n    const toolbarPosition = this._activeMode.button.offsetTop - 1;\n\n    // Recreate action buttons on every click\n    this._createActions(this._activeMode.handler);\n\n    // Correctly position the cancel button\n    this._actionsContainer.style.top = `${toolbarPosition}px`;\n\n    if (buttonIndex === 0) {\n      L.DomUtil.addClass(this._toolbarContainer, 'leaflet-draw-toolbar-notop');\n      L.DomUtil.addClass(this._actionsContainer, 'leaflet-draw-actions-top');\n    }\n\n    if (buttonIndex === lastButtonIndex) {\n      L.DomUtil.addClass(this._toolbarContainer, 'leaflet-draw-toolbar-nobottom');\n      L.DomUtil.addClass(this._actionsContainer, 'leaflet-draw-actions-bottom');\n    }\n\n    this._actionsContainer.style.display = 'block';\n  }\n\n  _hideActionsToolbar(): void {\n    this._actionsContainer.style.display = 'none';\n\n    L.DomUtil.removeClass(this._toolbarContainer, 'leaflet-draw-toolbar-notop');\n    L.DomUtil.removeClass(this._toolbarContainer, 'leaflet-draw-toolbar-nobottom');\n    L.DomUtil.removeClass(this._actionsContainer, 'leaflet-draw-actions-top');\n    L.DomUtil.removeClass(this._actionsContainer, 'leaflet-draw-actions-bottom');\n  }\n}\n\nconst Toolbar = BaseToolbar.extend({includes: L.Evented.prototype});\nexport default Toolbar;\n"]}